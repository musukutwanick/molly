<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Responses Dashboard</title>
<style>
  :root {
    --bg: #0b0b0b;
    --panel: #121212;
    --text: #f7e7f0;
    --accent: #ff5fa2;
  }
  body { margin:0; font-family: system-ui, -apple-system, Segoe UI, sans-serif; background: var(--bg); color: var(--text); }
  header { padding: 16px 20px; border-bottom: 1px solid #222; display:flex; align-items:center; justify-content:space-between; }
  h1 { font-size: 1.1rem; margin: 0; }
  main { padding: 20px; }
  .panel { background: var(--panel); border: 1px solid #222; border-radius: 12px; padding: 16px; }
  table { width: 100%; border-collapse: collapse; font-size: 0.95rem; }
  th, td { padding: 10px 8px; border-bottom: 1px solid #222; vertical-align: top; }
  th { text-align: left; color: #d7b7c9; }
  .row-actions { display:flex; gap:10px; }
  button { background: var(--accent); color: #000; border: none; padding: 10px 14px; border-radius: 10px; cursor: pointer; font-weight: 600; }
  .ghost { background: #1e1e1e; color: #ddd; border: 1px solid #2a2a2a; }
  .empty { opacity: 0.8; padding: 24px; text-align: center; }
  .muted { color:#bbb; font-size: 0.85rem; }
</style>
</head>
<body>
<header>
  <h1>Responses Dashboard</h1>
  <div class="row-actions">
    <button id="exportCsv">Export CSV</button>
    <button id="clearAll" class="ghost">Clear All</button>
  </div>
</header>
<main>
  <div class="panel">
    <table id="table">
      <thead>
        <tr>
          <th style="width: 34%">Answer</th>
          <th style="width: 28%">Time</th>
          <th>Device</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
    <div id="empty" class="empty muted" style="display:none;">No responses saved yet. Open your page and submit an answer; it will appear here on this device.</div>
  </div>
  <p class="muted">Tip: To collect answers across devices, set a webhook URL in index.html using <code>RESPONSES_ENDPOINT</code> (e.g., Formspree, Apps Script, Supabase Edge) and host both files.</p>
</main>
<script>
function load() {
  try {
    const list = JSON.parse(localStorage.getItem('responses') || '[]');
    return Array.isArray(list) ? list : [];
  } catch { return []; }
}

function render() {
  const data = load().reverse();
  const tbody = document.getElementById('tbody');
  const empty = document.getElementById('empty');
  tbody.innerHTML = '';
  if (!data.length) {
    empty.style.display = 'block';
    return;
  }
  empty.style.display = 'none';
  const fmt = (iso) => new Date(iso).toLocaleString();
  for (const row of data) {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${escapeHtml(row.answer)}</td><td>${fmt(row.timestamp)}</td><td class="muted">${escapeHtml(row.ua || '')}</td>`;
    tbody.appendChild(tr);
  }
}

function escapeHtml(s) {
  return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]));
}

document.getElementById('clearAll').addEventListener('click', () => {
  if (confirm('Clear all saved responses on this device?')) {
    localStorage.removeItem('responses');
    render();
  }
});

document.getElementById('exportCsv').addEventListener('click', () => {
  const data = load();
  if (!data.length) return;
  const header = ['answer','timestamp','userAgent'];
  const rows = [header.join(',')].concat(
    data.map(r => [quoteCsv(r.answer), r.timestamp, quoteCsv(r.ua || '')].join(','))
  );
  const blob = new Blob([rows.join('\n')], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'responses.csv'; a.click();
  URL.revokeObjectURL(url);
});

function quoteCsv(s) {
  const t = String(s).replace(/"/g, '""');
  return '"' + t + '"';
}

render();
</script>
</body>
</html>
